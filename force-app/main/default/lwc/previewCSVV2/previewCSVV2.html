<template>
    <div class="main-preview-div">
        <div class="close-div" onclick={handleClose} if:true={isPopup}>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 22 22"  fill="white" stroke="white">
                <path d="M20.7334 2.5537C20.8179 2.46918 20.885 2.36885 20.9307 2.25843C20.9765 2.14801 21 2.02966 21 1.91013C21 1.79061 20.9765 1.67226 20.9307 1.56184C20.885 1.45142 20.8179 1.35109 20.7334 1.26657C20.6489 1.18206 20.5486 1.11502 20.4382 1.06928C20.3277 1.02354 20.2094 1 20.0899 1C19.9703 1 19.852 1.02354 19.7416 1.06928C19.6311 1.11502 19.5308 1.18206 19.4463 1.26657L11 9.71469L2.5537 1.26657C2.46918 1.18206 2.36885 1.11502 2.25843 1.06928C2.14801 1.02354 2.02966 1 1.91013 1C1.79061 1 1.67226 1.02354 1.56184 1.06928C1.45142 1.11502 1.35109 1.18206 1.26657 1.26657C1.18206 1.35109 1.11502 1.45142 1.06928 1.56184C1.02354 1.67226 1 1.79061 1 1.91013C1 2.02966 1.02354 2.14801 1.06928 2.25843C1.11502 2.36885 1.18206 2.46918 1.26657 2.5537L9.71469 11L1.26657 19.4463C1.09589 19.617 1 19.8485 1 20.0899C1 20.3312 1.09589 20.5627 1.26657 20.7334C1.43726 20.9041 1.66875 21 1.91013 21C2.15152 21 2.38301 20.9041 2.5537 20.7334L11 12.2853L19.4463 20.7334C19.617 20.9041 19.8485 21 20.0899 21C20.3312 21 20.5627 20.9041 20.7334 20.7334C20.9041 20.5627 21 20.3312 21 20.0899C21 19.8485 20.9041 19.617 20.7334 19.4463L12.2853 11L20.7334 2.5537Z"/>
            </svg>
        </div>
        <div class="title-text" if:true={isPopup}>
            CSV Preview
        </div>
        <div class="note-div" if:false={noResultsFound}>
            *Note: Preview can only contain 25 records at max, the actual count of records may be different and description may be shortened.
        </div>
        <div class="preview-container">
            <table class="table" if:false={noResultsFound}>
                <tbody>
                    <template lwc:if={showAdditionalInfo}>
                        <template for:each={additionalInfo} for:item="info">
                            <tr key={info.field} class="additional-info table-row">
                                <th class="table-header">{info.field} :</th>
                                <td class="table-cell">{info.value}</td>
                            </tr>
                        </template>
                        <tr class="empty-row table-row"></tr>
                    </template>
                    <tr class="table-row">
                        <template for:each={fields} for:item="field">
                            <th class="table-header" key={field}>{field}</th>
                        </template>
                    </tr>
                    <template for:each={tableData} for:item="row">
                        <tr key={row} class="table-row">
                            <template for:each={row} for:item="cell">
                                <td key={cell.field} class="table-cell">{cell.value}</td>
                            </template>
                        </tr>
                    </template>
                </tbody>
            </table>
            <div class="no-results" if:true={noResultsFound}>
                <svg xmlns="http://www.w3.org/2000/svg" class="no-result-svg" width="160" height="210" viewBox="0 0 280 300" fill="none">
                    <use href="/resource/MVDG__noResultImage#no-result-image"></use>
                </svg>                     
                </br>
                <p><b>No data to preview!</b></p>
                <p>{noDataFoundText}</p>
            </div>
        </div>
        <div class="buttons-div" if:true={isPopup}>
            <div class="show-additional-info-input-div control-btn" onclick={toggleAdditionalInfoDiv} if:false={noResultsFound}>
                <svg xmlns="http://www.w3.org/2000/svg" onclick={toggleAdditionalInfoDiv} viewBox="-0.5 -0.5 16 16" fill="white" height="16" width="16"><path d="M7.499625 0.15L7.971500000000001 0.1536875L8.42425 0.16618750000000002L8.644 0.17575000000000002L9.0695625 0.2006875L9.4760625 0.2345C12.921 0.5689375 14.3638125 1.9493125 14.743062499999999 5.310437500000001L14.765125 5.5235625L14.798937500000001 5.9300625L14.829062500000001 6.464375L14.833499999999999 6.574624999999999L14.8459375 7.028124999999999L14.849625 7.5L14.8459375 7.971875000000001L14.833437499999999 8.424625L14.8239375 8.644375L14.798937500000001 9.0699375L14.765125 9.4764375C14.4306875 12.921375 13.050375 14.3641875 9.689187500000001 14.7434375L9.4760625 14.7655L9.0695625 14.7993125L8.53525 14.829437500000001L8.425 14.8338125L7.971500000000001 14.8463125L7.499625 14.850000000000001L7.02775 14.8463125L6.574999999999999 14.8338125L6.35525 14.824250000000001L5.9296875 14.7993125L5.523249999999999 14.7655C2.07825 14.4310625 0.6355 13.05075 0.2561875 9.6895625L0.2341875 9.4764375L0.200375 9.0699375L0.1701875 8.535625L0.16581249999999997 8.425375L0.1533125 7.971875000000001L0.150375 7.738125V7.261875L0.1533125 7.028124999999999L0.16581249999999997 6.575375L0.175375 6.355625L0.2003125 5.9300625L0.234125 5.5235625C0.5685625 2.078625 1.9489375 0.6358125000000001 5.3100625 0.25656249999999997L5.5231875 0.2345L5.9296875 0.2006875L6.4639999999999995 0.17056249999999998L6.57425 0.166125L7.02775 0.1536875C7.182125 0.1514375 7.339375 0.15 7.499625 0.15ZM7.499625 6.765H6.764625L6.678625 6.770125C6.1168125 6.8369374999999994 5.838 7.486937500000001 6.17675 7.940125C6.297312499999999 8.101312499999999 6.47875 8.2060625 6.678625 8.229875L6.764625 8.235V10.440000000000001L6.76975 10.526C6.8096250000000005 10.863750000000001 7.0759375 11.129999999999999 7.413625000000001 11.169875000000001L7.499625 11.174999999999999H8.234625L8.320625 11.169875000000001C8.658375 11.129999999999999 8.924687500000001 10.863750000000001 8.9645 10.526L8.969625 10.440000000000001L8.9645 10.354000000000001C8.9285 10.0468125 8.703999999999999 9.795 8.4029375 9.724125L8.320625 9.7094375L8.234625 9.705V7.5L8.2295 7.414C8.1896875 7.07625 7.923375 6.8100000000000005 7.585625 6.770125L7.499625 6.765ZM7.507000000000001 4.5600000000000005L7.413625000000001 4.565125C6.851812499999999 4.6319375 6.573 5.2819375 6.91175 5.735125C7.0323125 5.8963125000000005 7.21375 6.0010625 7.413625000000001 6.024875L7.499625 6.029999999999999L7.593 6.024875C8.1548125 5.9580625 8.433625 5.3080625 8.094875 4.854875C7.9743125 4.6936875 7.792875 4.5889375 7.593 4.565125L7.507000000000001 4.5600000000000005Z" stroke-width="1"></path></svg>
                Toggle Additional Info
            </div>
            <div class="edit-btn control-btn" onclick={handleClose}>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 22 22" width="13" height="13" fill="white" stroke="white"><path d="M20.7334 2.5537C20.8179 2.46918 20.885 2.36885 20.9307 2.25843C20.9765 2.14801 21 2.02966 21 1.91013C21 1.79061 20.9765 1.67226 20.9307 1.56184C20.885 1.45142 20.8179 1.35109 20.7334 1.26657C20.6489 1.18206 20.5486 1.11502 20.4382 1.06928C20.3277 1.02354 20.2094 1 20.0899 1C19.9703 1 19.852 1.02354 19.7416 1.06928C19.6311 1.11502 19.5308 1.18206 19.4463 1.26657L11 9.71469L2.5537 1.26657C2.46918 1.18206 2.36885 1.11502 2.25843 1.06928C2.14801 1.02354 2.02966 1 1.91013 1C1.79061 1 1.67226 1.02354 1.56184 1.06928C1.45142 1.11502 1.35109 1.18206 1.26657 1.26657C1.18206 1.35109 1.11502 1.45142 1.06928 1.56184C1.02354 1.67226 1 1.79061 1 1.91013C1 2.02966 1.02354 2.14801 1.06928 2.25843C1.11502 2.36885 1.18206 2.46918 1.26657 2.5537L9.71469 11L1.26657 19.4463C1.09589 19.617 1 19.8485 1 20.0899C1 20.3312 1.09589 20.5627 1.26657 20.7334C1.43726 20.9041 1.66875 21 1.91013 21C2.15152 21 2.38301 20.9041 2.5537 20.7334L11 12.2853L19.4463 20.7334C19.617 20.9041 19.8485 21 20.0899 21C20.3312 21 20.5627 20.9041 20.7334 20.7334C20.9041 20.5627 21 20.3312 21 20.0899C21 19.8485 20.9041 19.617 20.7334 19.4463L12.2853 11L20.7334 2.5537Z"></path></svg>
                Close
            </div>
            <div class="edit-btn control-btn" onclick={handleEditClick} if:false={previewFromEditor}>
                <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" fill="white" viewBox="0 0 512 512"><path d="M471.6 21.7c-21.9-21.9-57.3-21.9-79.2 0L362.3 51.7l97.9 97.9 30.1-30.1c21.9-21.9 21.9-57.3 0-79.2L471.6 21.7zm-299.2 220c-6.1 6.1-10.8 13.6-13.5 21.9l-29.6 88.8c-2.9 8.6-.6 18.1 5.8 24.6s15.9 8.7 24.6 5.8l88.8-29.6c8.2-2.7 15.7-7.4 21.9-13.5L437.7 172.3 339.7 74.3 172.4 241.7zM96 64C43 64 0 107 0 160V416c0 53 43 96 96 96H352c53 0 96-43 96-96V320c0-17.7-14.3-32-32-32s-32 14.3-32 32v96c0 17.7-14.3 32-32 32H96c-17.7 0-32-14.3-32-32V160c0-17.7 14.3-32 32-32h96c17.7 0 32-14.3 32-32s-14.3-32-32-32H96z"/></svg>
                Edit Template
            </div>
            <div class="Generate-btn control-btn" onclick={handleGenerateClick} >
                <svg xmlns="http://www.w3.org/2000/svg" class={canNotGenerate} width="15" height="15" fill="white" viewBox="0 0 384 512"><path d="M64 0C28.7 0 0 28.7 0 64V448c0 35.3 28.7 64 64 64H320c35.3 0 64-28.7 64-64V160H256c-17.7 0-32-14.3-32-32V0H64zM256 0V128H384L256 0zM80 64h64c8.8 0 16 7.2 16 16s-7.2 16-16 16H80c-8.8 0-16-7.2-16-16s7.2-16 16-16zm0 64h64c8.8 0 16 7.2 16 16s-7.2 16-16 16H80c-8.8 0-16-7.2-16-16s7.2-16 16-16zm16 96H288c17.7 0 32 14.3 32 32v64c0 17.7-14.3 32-32 32H96c-17.7 0-32-14.3-32-32V256c0-17.7 14.3-32 32-32zm0 32v64H288V256H96zM240 416h64c8.8 0 16 7.2 16 16s-7.2 16-16 16H240c-8.8 0-16-7.2-16-16s7.2-16 16-16z"/></svg>
                Generate
            </div>
        </div>
    </div>
    <c-document-loader-v2 display={showSpinner}></c-document-loader-v2>
    <c-generate-document-v2
        if:true={isGenerate}
        template-id-from-parent={templateId}
        object-api-name={objectName}
        called-from-where = "preview"
        onclose = {closeGenerate}
    ></c-generate-document-v2>
</template>